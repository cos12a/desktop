import{r as p,d as le,g as ee,n as te,c as U,a as e,f as P,w as x,k as H,F as G,e as J,u as k,v as j,t as I,o as w,_ as oe,p as ge,s as re,j as ye,l as se,T as Ce,q as we,x as Ae,b as q,y as Se,z as Ue,A as he,B as Z}from"./index-OFl76lSV.js";import{u as ce,r as Be,d as de,a as De,t as Te,e as xe}from"./bluetoothConnection-2f9W_nLX.js";import"./UnitoProductConfig-B75oaK1v.js";function Ee(m,y,n){const t=p(null),r=p(null),C=p(!1);async function b(A){if(!m.value)return!1;console.log("Subscribing to characteristic:",y,n);const h=await(await m.value.getPrimaryService(y)).getCharacteristic(n);return r.value&&t.value&&t.value.removeEventListener("characteristicvaluechanged",r.value),h.properties.notify?(await h.startNotifications(),r.value=l=>{const d=l.target;if(d.value){const S=new Uint8Array(d.value.buffer);A(S)}},h.addEventListener("characteristicvaluechanged",r.value),t.value=h,C.value=!0,!0):!1}async function g(){try{r.value&&t.value&&(t.value.removeEventListener("characteristicvaluechanged",r.value),r.value=null),t.value&&(await t.value.stopNotifications().catch(()=>{}),t.value=null)}finally{C.value=!1}}async function v(A){if(!m.value)return;const h=await(await m.value.getPrimaryService(y)).getCharacteristic(n);let l;if(A instanceof Uint8Array)l=A;else if(/^[0-9a-fA-F]+$/.test(A)&&A.length%2===0){const d=A.match(/.{1,2}/g)?.map(S=>parseInt(S,16))||[];l=new Uint8Array(d)}else l=new TextEncoder().encode(A);await h.writeValue(l)}return{isSubscribed:C,subscribe:b,unsubscribe:g,send:v}}function ue(m,y){const n=p({}),t=new Map,r=new Map;function C(l){const d=Ee(m,y,l);return n.value[l]=d,d}async function b(l,d){r.has(l)||r.set(l,new Set),r.get(l).add(d);const S=n.value[l];if(S&&S.isSubscribed?.value)return console.log("ç‰¹å¾å·²è®¢é˜…ï¼Œç›´æŽ¥è¿”å›žæˆåŠŸ:",l),!0;if(console.log("ç‰¹å¾æœªè®¢é˜…ï¼Œè¿›è¡Œè®¢é˜…:",l),t.has(l))return t.get(l);const D=(async()=>{const E=n.value[l]||C(l);n.value[l]=E;const N=o=>{const u=r.get(l);if(!(!u||u.size===0))for(const T of Array.from(u))try{T(o)}catch($){console.warn("notify handler error",$)}};try{const o=await E.subscribe(N);if(!o){try{await E.unsubscribe()}catch{}delete n.value[l],r.delete(l)}return o}catch(o){try{await E.unsubscribe()}catch{}throw delete n.value[l],r.delete(l),o}finally{t.delete(l)}})();return t.set(l,D),D}async function g(l,d){if(d){const D=r.get(l);if(D&&(D.delete(d),D.size===0)){r.delete(l);const E=n.value[l];if(E)try{await E.unsubscribe()}catch{}finally{delete n.value[l]}}return}const S=n.value[l];if(!S){r.delete(l);return}try{await S.unsubscribe()}catch{}finally{delete n.value[l],r.delete(l)}}async function v(l,d){await(n.value[l]||C(l)).send(d)}function A(){return Object.entries(n.value).filter(([l,d])=>d.isSubscribed.value).map(([l])=>l)}async function _(l){if(!m.value)throw new Error("No GATT server connected");const D=await(await(await m.value.getPrimaryService(y)).getCharacteristic(l)).readValue();return new Uint8Array(D.buffer)}async function h(){const l=Object.keys(n.value),d=[];for(const S of l){if(t.has(S))try{await t.get(S)}catch{}finally{t.delete(S)}const D=n.value[S];if(!D){delete n.value[S];continue}const E=(async()=>{try{if(typeof D.unsubscribe=="function")try{D.isSubscribed?.value?await D.unsubscribe():await D.unsubscribe().catch(()=>{})}catch{}}finally{delete n.value[S],r.delete(S)}})();d.push(E)}await Promise.all(d).catch(()=>{}),n.value={},t.clear(),r.clear()}return{channels:n,subscribe:b,unsubscribe:g,send:v,getSubscribedUuids:A,read:_,destroy:h}}const R=7,ve=2,ne=11;function fe(m){return m+R+ve}function pe(m,y){let n=0;for(let t=1;t<y+R;t++)n+=m[t];return 256-(n&127)&255}function Ie(m){const{dst:y,src:n,msg_id:t,msg_cat:r,data:C}=m,b=C.length;if(b<1||b>ne)throw new Error(`Invalid payload length: ${b} (must be 1..${ne})`);const g=fe(b),v=new Uint8Array(g);v[0]=0,v[1]=y&255,v[2]=n&255,v[3]=t&255,v[4]=t>>8&255,v[5]=r&255,v[6]=b&255,v.set(C,R);const A=pe(v,b);return v[R+b]=A,v[R+b+1]=255,v}function _e(m){const y=m.length;if(y<R+ve+1||m[0]!==0)return!1;const n=m[6];if(n<1||n>ne||y!==fe(n))return!1;const t=R+n,r=t+1;if(m[r]!==255)return!1;const C=pe(m,n),b=m[t];return C===b}function ke(m,y,n,t,r){return Ie({dst:m,src:y,msg_id:n,msg_cat:t,data:r})}function me(m){return Array.from(m).map(y=>"0x"+y.toString(16).padStart(2,"0")).join(" ")}const Ne={class:"smaps-builder"},Oe={class:"form"},Pe=["value"],Me=["value"],We=["value"],Fe={class:"hint"},Q=11,$e=le({__name:"SmapsBuilder",emits:["generated"],setup(m,{emit:y}){const n=[{label:"ANY (0x00)",value:0},{label:"WATER_SYSTEM (0x01)",value:1},{label:"HOOD (0x02)",value:2},{label:"WSYS_DISPLAY (0x03)",value:3},{label:"COOKER (0x04)",value:4},{label:"HOOD_DISPLAY (0x05)",value:5},{label:"APP_EXT (0x06)",value:6},{label:"APP_INT (0x07)",value:7},{label:"CLOUD (0x08)",value:8},{label:"TESTER_APP (0x09)",value:9},{label:"INSTALLER_APP (0x0a)",value:10},{label:"HUB (0x0b)",value:11},{label:"VR_TIANA_APP (0x0c)",value:12},{label:"ALEXA (0x0e)",value:14}],t=n,r=[{label:"UNITO_MSGCAT_GET (0x01)",value:1},{label:"UNITO_MSGCAT_SET (0x02)",value:2},{label:"UNITO_MSGCAT_CLEAR (0x03)",value:3},{label:"UNITO_MSGCAT_RESPONSE (0x04)",value:4},{label:"UNITO_MSGCAT_REPORT (0x05)",value:5},{label:"UNITO_FW_INITIATED_MSG (0x06)",value:6},{label:"UNITO_FW_INITIATED_EVT (0x07)",value:7}],C=p(1),b=p(6),g=p("FEEF"),v=p(2),A=p("01"),_=p(new Uint8Array),h=p(!1),l=new Uint8Array([1]),d=ee(()=>{try{return S(A.value).length}catch{return 0}});ee(()=>_.value.length?me(_.value):"");function S(N){const o=N.trim().split(/\s+/).filter(Boolean);if(o.length===0)return l;const u=o.map(T=>{const $=parseInt(T,16);if(isNaN($)||$<0||$>255)throw new Error(`éžæ³• HEX å­—èŠ‚: ${T}`);return $});return u.length>Q?(console.warn(`data é•¿åº¦ ${u.length} è¶…è¿‡æœ€å¤§ ${Q}ï¼Œå·²æˆªæ–­`),new Uint8Array(u.slice(0,Q))):u.length===0?l:new Uint8Array(u)}function D(){try{const N=S(A.value),o=g.value.trim().replace(/^0x/i,""),u=o.length?parseInt(o,16):0;if(isNaN(u)||u<0||u>65535)throw new Error("msg_id éžæ³•ï¼ˆéœ€ä¸º 16 ä½ä»¥å†… HEXï¼‰");_.value=ke(C.value,b.value,u,v.value,N),h.value=_e(_.value)}catch{_.value=new Uint8Array,h.value=!1}}const E=y;return te([C,b,g,v,A],()=>{D()},{immediate:!0}),te([_,h],([N,o])=>{o&&N.length&&E("generated",N)},{immediate:!0}),(N,o)=>(w(),U("div",Ne,[o[11]||(o[11]=e("h3",null,"ðŸ“¦ SMAPS æ¶ˆæ¯æž„é€ å™¨",-1)),e("div",Oe,[e("label",null,[o[5]||(o[5]=P("ç›®æ ‡åœ°å€ dst: ",-1)),x(e("select",{"onUpdate:modelValue":o[0]||(o[0]=u=>C.value=u)},[(w(),U(G,null,J(n,u=>e("option",{key:u.value,value:u.value},I(u.label),9,Pe)),64))],512),[[H,C.value,void 0,{number:!0}]])]),e("label",null,[o[6]||(o[6]=P("æºåœ°å€ src: ",-1)),x(e("select",{"onUpdate:modelValue":o[1]||(o[1]=u=>b.value=u)},[(w(!0),U(G,null,J(k(t),u=>(w(),U("option",{key:u.value,value:u.value},I(u.label),9,Me))),128))],512),[[H,b.value,void 0,{number:!0}]])]),e("label",null,[o[7]||(o[7]=P("æ¶ˆæ¯ ID msg_id (HEX): ",-1)),x(e("input",{"onUpdate:modelValue":o[2]||(o[2]=u=>g.value=u),placeholder:"e.g. FEEF"},null,512),[[j,g.value]])]),e("label",null,[o[8]||(o[8]=P("æ¶ˆæ¯ç±»åˆ« msg_cat: ",-1)),x(e("select",{"onUpdate:modelValue":o[3]||(o[3]=u=>v.value=u)},[(w(),U(G,null,J(r,u=>e("option",{key:u.value,value:u.value},I(u.label),9,We)),64))],512),[[H,v.value,void 0,{number:!0}]])]),e("label",null,[o[9]||(o[9]=P("æ•°æ®å†…å®¹ data (HEX): ",-1)),x(e("input",{"onUpdate:modelValue":o[4]||(o[4]=u=>A.value=u),placeholder:"01 02 03"},null,512),[[j,A.value]])]),e("p",Fe,[o[10]||(o[10]=P(" æ•°æ®é•¿åº¦ data_len: ",-1)),e("strong",null,I(d.value),1)])])]))}}),Le=oe($e,[["__scopeId","data-v-1f6f4cd5"]]),Ve={class:"modal-content"},qe={class:"modal-body"},He={class:"json-editor"},Re={class:"form-group"},je={class:"form-group"},Ge={key:0,class:"password-input-container"},Je=["type"],Ye=["title"],Xe={class:"form-group"},ze={class:"form-group"},Ze={class:"form-group"},Qe={style:{"max-height":"200px","overflow-y":"auto",background:"#f9f9f9",padding:"10px",border:"1px solid #ddd"}},Ke="YellowSubmarine_",et=le({__name:"WifiConfigNetwork",props:{visible:{type:Boolean}},emits:["update","confirmed","closed"],setup(m,{emit:y}){const n=y,t=ge({WifiSsid:"mqtt",To:"Hub",InstallationCountry:"",Action:"ProvData",BaseUrl:"https://iot-web.unito-oauth.com",WaterSystemExisting:"Yes",TimeZone:"+8",UserAppType:"ios",WifiPassword:"11221122",From:"App",UserAppDeviceUuid:"175DA3CC-F2B5-4CD0-A65E-A3B58BF0DB01",MqttBaseUrl:"mqtts://iot.unito-oauth.com:8883"}),r=p(""),C=p(""),b=p(""),g=p(""),v=p(""),A=M=>{const s=M.target;s.value!=="custom"&&(t.BaseUrl=s.value,s.value.includes("test")?t.MqttBaseUrl="mqtts://iot-test.unito-oauth.com:8883":t.MqttBaseUrl="mqtts://iot.unito-oauth.com:8883")},_=()=>{C.value&&(t.BaseUrl=C.value,C.value.includes("test")?t.MqttBaseUrl="mqtts://iot-test.unito-oauth.com:8883":t.MqttBaseUrl="mqtts://iot.unito-oauth.com:8883")},h=p(!1),l=()=>{h.value=!h.value},d=(M,s)=>{const i=s.target;i.value!=="custom"&&(t[M]=i.value)},S=()=>{t.WifiSsid==="custom"&&(t.WifiSsid=r.value),t.BaseUrl==="custom"&&(t.BaseUrl=C.value),t.MqttBaseUrl==="custom"&&(t.MqttBaseUrl=b.value),t.WifiPassword==="custom"&&(t.WifiPassword=g.value),t.UserAppDeviceUuid==="custom"&&(t.UserAppDeviceUuid=v.value),console.log(r.value,C.value,b.value,g.value,v.value),console.log("ç”Ÿæˆçš„é…ç½®æ•°æ®:",t);const M={...t},s=JSON.stringify(M,null,2);n("confirmed",s)},D=()=>{Object.assign(t,{WifiSsid:"mqtt",BaseUrl:"https://iot-web.unito-oauth.com",MqttBaseUrl:"mqtts://iot.unito-oauth.com:8883",WifiPassword:"11221122",UserAppDeviceUuid:"175DA3CC-F2B5-4CD0-A65E-A3B58BF0DB01"}),r.value="",C.value="",b.value="",g.value="",v.value=""},E=()=>{n("update",!1),n("closed")},N=ce(),{device:o,server:u}=re(N),T=p([]);async function $(){const M="0000ffe1-0000-1000-8000-00805f9b34fb",s="00002a3d-0000-1000-8000-00805f9b34fb";try{const i=await Be(u.value,s,M);if(!i||i.length===0){T.value.unshift("âŒ è¯»å–åˆ°çš„é…ç½‘æ•°æ®ä¸ºç©º"),console.error("è¯»å–åˆ°çš„é…ç½‘æ•°æ®ä¸ºç©º");return}const W=Array.from(i).map(F=>F.toString(16).padStart(2,"0")).join("");T.value.unshift("raw hex: "+W),console.log("raw hex: ",W);const L=de(W,Ke);if(!L){T.value.unshift("âš ï¸ è§£å¯†ä¸ºç©º");return}console.log("è§£å¯†åŽæ–‡æœ¬: ",L);try{const F=await X(L);console.log("å‘é€åˆ°æœåŠ¡å™¨ï¼Œè¿”å›ž: ",F),T.value.unshift("âœ… è§£å¯†å¹¶è§£æžä¸º JSON æˆåŠŸ: "+JSON.stringify(F)),F.msg==="success"?T.value.unshift("ðŸŽ‰ è®¾å¤‡ç»‘å®šæˆåŠŸï¼"):T.value.unshift("âŒ è®¾å¤‡ç»‘å®šå¤±è´¥: "+(F.detail||"æœªçŸ¥é”™è¯¯"))}catch{T.value.unshift("âš ï¸ è§£å¯†æˆåŠŸä½†è§£æžä¸º JSON å¤±è´¥ï¼Œæ˜¾ç¤º raw"),console.warn("è§£å¯†æˆåŠŸä½†è§£æžä¸º JSON å¤±è´¥ï¼Œæ˜¾ç¤º raw")}}catch(i){T.value.unshift("âŒ è¯»å–é…ç½‘æ•°æ®å¤±è´¥: "+(i?.message||i))}}async function X(M){const s="3.8.04292024",i="WsInf_51",W="175DA3CC-F2B5-4CD0-A65E-A3B58BF0DB04",F="Asia/Shanghai";try{const V=JSON.parse(M);console.log("Parsed JSON for registration:",V);const z={AppVersion:s,WsProductName:i,HubToken:V.HubToken,UserAppDeviceUUID:W,UserAppType:"ios",TimeZoneId:F,TimeZone:"+8"};return await(await fetch("https://red.yzluo.top/proxy/unito/app/homeRegister",{method:"POST",headers:{"Content-Type":"application/json",Authorization:V.HubSn},body:JSON.stringify(z)})).json()}catch(V){return console.error("å‘é€æ³¨å†Œè¯·æ±‚å¤±è´¥:",V),{msg:"error",detail:V?.message||"æœªçŸ¥é”™è¯¯"}}}return(M,s)=>(w(),ye(Ae,{to:"body"},[se(Ce,{name:"modal-fade"},{default:we(()=>[m.visible?(w(),U("div",{key:0,class:"modal-overlay",onClick:Se(E,["self"])},[e("div",Ve,[e("div",{class:"modal-header"},[s[14]||(s[14]=e("h3",null,"WIFIé…ç½‘é¡µé¢",-1)),e("button",{class:"close-btn",onClick:E})]),e("div",qe,[e("div",He,[e("div",Re,[s[16]||(s[16]=e("label",null,"Wifi SSID:",-1)),x(e("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>t.WifiSsid=i),onChange:s[1]||(s[1]=i=>d("WifiSsid",i))},[...s[15]||(s[15]=[e("option",{value:"mqtt"},"mqtt",-1),e("option",{value:"Unito-Tech-Private"},"Unito-Tech-Private",-1),e("option",{value:"msyssid"},"myssid",-1),e("option",{value:"custom"},"è‡ªå®šä¹‰",-1)])],544),[[H,t.WifiSsid]]),t.WifiSsid==="custom"?x((w(),U("input",{key:0,"onUpdate:modelValue":s[2]||(s[2]=i=>r.value=i),placeholder:"è¾“å…¥è‡ªå®šä¹‰Wifi SSID",class:"custom-input"},null,512)),[[j,r.value]]):q("",!0)]),e("div",je,[s[18]||(s[18]=e("label",null,"Wifiå¯†ç :",-1)),x(e("select",{"onUpdate:modelValue":s[3]||(s[3]=i=>t.WifiPassword=i),onChange:s[4]||(s[4]=i=>d("WifiPassword",i))},[...s[17]||(s[17]=[e("option",{value:"11221122"},"mqtt-p",-1),e("option",{value:"UNITO1234!@#"},"UNITO-p",-1),e("option",{value:"mypassword"},"myssid-p",-1),e("option",{value:"custom"},"è‡ªå®šä¹‰",-1)])],544),[[H,t.WifiPassword]]),t.WifiPassword==="custom"?(w(),U("div",Ge,[x(e("input",{"onUpdate:modelValue":s[5]||(s[5]=i=>g.value=i),placeholder:"è¾“å…¥è‡ªå®šä¹‰å¯†ç ",type:h.value?"text":"password",class:"custom-input password-input"},null,8,Je),[[Ue,g.value]]),e("button",{type:"button",onClick:l,class:"password-toggle-btn",title:h.value?"éšè—å¯†ç ":"æ˜¾ç¤ºå¯†ç "},I(h.value?"ðŸ™ˆ":"ðŸ‘ï¸"),9,Ye)])):q("",!0)]),e("div",Xe,[s[20]||(s[20]=e("label",null,"Base URL:",-1)),x(e("select",{"onUpdate:modelValue":s[6]||(s[6]=i=>t.BaseUrl=i),onChange:A},[...s[19]||(s[19]=[e("option",{value:"https://iot-web.unito-oauth.com"},"æ­£å¼æœåŠ¡å™¨ (iot-web)",-1),e("option",{value:"https://iot-test.unito-oauth.com"},"æµ‹è¯•æœåŠ¡å™¨ (iot-test)",-1),e("option",{value:"custom"},"è‡ªå®šä¹‰",-1)])],544),[[H,t.BaseUrl]]),t.BaseUrl==="custom"?x((w(),U("input",{key:0,"onUpdate:modelValue":s[7]||(s[7]=i=>C.value=i),placeholder:"è¾“å…¥è‡ªå®šä¹‰Base URL",onBlur:_,class:"custom-input"},null,544)),[[j,C.value]]):q("",!0)]),e("div",ze,[s[22]||(s[22]=e("label",null,"MQTT Base URL:",-1)),x(e("select",{"onUpdate:modelValue":s[8]||(s[8]=i=>t.MqttBaseUrl=i),onChange:s[9]||(s[9]=i=>d("MqttBaseUrl",i))},[...s[21]||(s[21]=[e("option",{value:"mqtts://iot.unito-oauth.com:8883"},"æ­£å¼MQTT (iot)",-1),e("option",{value:"mqtts://iot-test.unito-oauth.com:8883"},"æµ‹è¯•MQTT (iot-test)",-1),e("option",{value:"custom"},"è‡ªå®šä¹‰",-1)])],544),[[H,t.MqttBaseUrl]]),t.MqttBaseUrl==="custom"?x((w(),U("input",{key:0,"onUpdate:modelValue":s[10]||(s[10]=i=>b.value=i),placeholder:"è¾“å…¥è‡ªå®šä¹‰MQTT URL",class:"custom-input"},null,512)),[[j,b.value]]):q("",!0)]),e("div",Ze,[s[24]||(s[24]=e("label",null,"ç”¨æˆ·è®¾å¤‡UUID:",-1)),x(e("select",{"onUpdate:modelValue":s[11]||(s[11]=i=>t.UserAppDeviceUuid=i),onChange:s[12]||(s[12]=i=>d("UserAppDeviceUuid",i))},[...s[23]||(s[23]=[e("option",{value:"175DA3CC-F2B5-4CD0-A65E-A3B58BF0DB01"},"175DA3CC-...-DB01",-1),e("option",{value:"175DA3CC-F2B5-4CD0-A65E-A3B58BF0DB02"},"175DA3CC-...-DB02",-1),e("option",{value:"75DA3CC-F2B5-4CD0-A65E-A3B58BF0DB03"},"75DA3CC-...-DB03",-1),e("option",{value:"75DA3CC-F2B5-4CD0-A65E-A3B58BF0DB04"},"75DA3CC-...-DB04",-1),e("option",{value:"custom"},"è‡ªå®šä¹‰",-1)])],544),[[H,t.UserAppDeviceUuid]]),t.UserAppDeviceUuid==="custom"?x((w(),U("input",{key:0,"onUpdate:modelValue":s[13]||(s[13]=i=>v.value=i),placeholder:"è¾“å…¥è‡ªå®šä¹‰UUID",class:"custom-input"},null,512)),[[j,v.value]]):q("",!0)]),e("div",{class:"actions"},[e("button",{onClick:S,class:"generate-btn"},"å¼€å§‹é…ç½‘"),e("button",{onClick:D,class:"reset-btn"},"é‡ç½®æ•°æ®"),e("button",{onClick:$,class:"reset-btn"},"ç»‘å®šAPP"),e("button",{onClick:E,class:"reset-btn"},"é€€å‡ºé…ç½‘")]),e("div",null,[s[25]||(s[25]=e("h4",null,"æ—¥å¿—è¾“å‡º:",-1)),e("div",Qe,[(w(!0),U(G,null,J(T.value,(i,W)=>(w(),U("div",{key:W,style:{"margin-bottom":"5px"}},I(i),1))),128))])])])])])])):q("",!0)]),_:1})]))}}),tt=oe(et,[["__scopeId","data-v-b5c23ee9"]]),st={class:"page"},nt={class:"controls"},lt=["disabled"],ot=["disabled"],at={key:0},it={key:1},ut={class:"controls"},rt=["disabled"],ct=["disabled"],dt=["disabled"],vt={key:0},ft={key:1},pt={class:"wifi-display"},mt={key:0,class:"wifi-fields"},bt={key:1,class:"wifi-empty"},gt=["disabled"],yt={key:0,class:"modal-overlay"},Ct={class:"controls",style:{display:"flex","flex-direction":"column",gap:"6px"}},wt={key:0},At=["disabled"],St=["disabled"],Ut={class:"checkbox-group"},ht={class:"log"},Bt="0000ffe0-0000-1000-8000-00805f9b34fb",K="YellowSubmarine_",Dt=le({__name:"dataDebug",setup(m){const y=ce(),{isConnected:n,device:t,server:r,isSupported:C}=re(y),b=p("0000ffe1-0000-1000-8000-00805f9b34fb");p(""),p(!1);const g=p([]),v=p(!1),A=p(!1),_=ue(r,Bt),h=p([]),l=p(null),d=p("æœªæ“ä½œ"),S=p(""),D=ee(()=>d.value.includes("æˆåŠŸ")||d.value.includes("å®Œæˆ")?"success":"");async function E(f){if(!n.value)return;await _.subscribe(f,c=>V(f,c))?(console.log(`âœ… æˆåŠŸè®¢é˜… ${f}`),v.value=!0):console.warn(`âŒ è®¢é˜…å¤±è´¥ ${f}`)}function N(f){n.value&&(_.unsubscribe(f),v.value=!1)}const o=p("string");async function u(){if(!r.value||!n.value){console.log("âœ… æ²¡æœ‰è¿žæŽ¥Ble:");return}try{const f=await De(r.value,"YellowSubmarine_");l.value=f.parsed;const a={device:t.value?.name||"æœªçŸ¥è®¾å¤‡",name:t.value?.id||"æœªçŸ¥MAC",data:typeof f.plainText=="string"&&f.plainText.length?f.plainText:JSON.stringify(f.parsed||{}),timestamp:f.timestamp};d.value="ðŸš€ æ­£åœ¨æ£€æµ‹æ•°æ®â€¦";const c=await fetch("https://red.yzluo.top/bledata",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!c.ok)throw new Error(c.statusText);const B=await c.json();d.value="ðŸš€ æ•°æ®æ£€æµ‹å®Œæˆ",g.value.unshift("POST è¿”å›ž: "+JSON.stringify(B))}catch(f){console.error("âŒ è¯»å–å¤±è´¥:",f.message||f),d.value="âŒ è¯»å–å¤±è´¥"}}const T=p(!1),$=()=>{T.value=!0},X=f=>{i(f)},M=()=>{T.value=!1};te(n,f=>{f||(T.value=!1,A.value=!1)});const s=()=>{A.value?A.value=!1:A.value=!0};async function i(f){if(!n.value){g.value.unshift("âŒ æœªè¿žæŽ¥ï¼Œæ— æ³•å‘é€é…ç½®æ•°æ®");return}const a="0000ffe1-0000-1000-8000-00805f9b34fb",c="0000ffe1-0000-1000-8000-00805f9b34fb";try{const B=ue(r,a);let Y=f;const O=xe(Y,K);if(!O){g.value.unshift("âŒ åŠ å¯†å¤±è´¥"),await B.destroy();return}Y=O;try{await B.send(c,Y),g.value.unshift("âœ… é…ç½‘æ•°æ®å·²å‘é€")}finally{await B.destroy()}}catch{g.value.unshift("âŒ å‘é€é…ç½®æ•°æ®å¤±è´¥: ")}}const W=p(null),L=p("");function F(f){W.value=f,L.value=me(f)}async function ae(f){if(!n.value){g.value.unshift("âŒ æœªè¿žæŽ¥ï¼Œæ— æ³•å‘é€");return}if(!W.value||!W.value.length){g.value.unshift("âŒ æ— é€‰ä¸­æ•°æ®");return}try{await _.send(f,W.value),g.value.unshift("âž¡ï¸ å·²å‘é€ ç”Ÿæˆæ•°æ®: "+L.value)}catch(a){g.value.unshift("âŒ å‘é€å¤±è´¥: "+(a?.message||a))}}function V(f,a){const c=Array.from(a).map(O=>O.toString(16).padStart(2,"0")).join("");console.log("æ”¶åˆ°é€šçŸ¥æ¥è‡ª",f,"æ•°æ®(hex):",c);let B="";if(o.value==="hex")B=c,console.log("Hex æ˜¾ç¤ºæ¨¡å¼ï¼Œæ•°æ®:",B);else if(o.value==="decrypt")try{Te(c,K),console.log("å°è¯•è§£å¯†æ•°æ®(hex):",c);const O=de(c,K);if(!O)B="[è§£å¯†å¤±è´¥]",console.warn("è§£å¯†ç»“æžœä¸ºç©º");else{console.log("è§£å¯†ç»“æžœ:",O);try{const be=JSON.parse(O);B=JSON.stringify(be,null,2)}catch{B=O}}}catch(O){console.error("è§£å¯†å¼‚å¸¸:",O),B="[è§£å¯†é”™è¯¯: æœªçŸ¥é”™è¯¯]"}else try{const O=new TextDecoder().decode(a);O.trim()?B=O:B="[ç©ºæ•°æ®]"}catch{B=`[éž UTF - 8 æ•°æ®ï¼Œhex: ${c}]`}const Y=new Date().toLocaleTimeString();h.value.unshift({time:Y,uuid:f,data:B}),h.value.length>20&&h.value.splice(20)}function z(){g.value=[]}function ie(){h.value=[]}return(f,a)=>(w(),U("section",st,[a[16]||(a[16]=e("h1",null,"Web è“ç‰™ Demo",-1)),e("div",nt,[e("button",{onClick:a[0]||(a[0]=(...c)=>k(y).connect&&k(y).connect(...c)),disabled:!k(C)||k(n)},"è¿žæŽ¥",8,lt),e("button",{onClick:a[1]||(a[1]=(...c)=>k(y).disconnect&&k(y).disconnect(...c)),disabled:!k(n)},"æ–­å¼€",8,ot),k(n)?(w(),U("span",at,"âœ… å·²è¿žæŽ¥: "+I(k(t)?.name||"æœªçŸ¥è®¾å¤‡"),1)):(w(),U("span",it,"âŒ æœªè¿žæŽ¥"))]),a[17]||(a[17]=e("h3",null,"è“ç‰™ç‰¹å¾è®¢é˜…æŽ§åˆ¶",-1)),e("div",ut,[e("button",{onClick:a[2]||(a[2]=c=>E(b.value)),disabled:!k(n)||v.value},"è®¢é˜…",8,rt),e("button",{onClick:a[3]||(a[3]=c=>N(b.value)),disabled:!k(n)||!v.value},"å–æ¶ˆè®¢é˜…",8,ct),e("button",{onClick:u,disabled:!k(n)},"èŽ·å–é…ç½‘æ•°æ®",8,dt),v.value?(w(),U("span",vt,"ðŸ“¡ å·²è®¢é˜…")):(w(),U("span",ft,"æœªè®¢é˜…"))]),a[18]||(a[18]=e("h3",null,"é…ç½‘æ•°æ®",-1)),e("div",pt,[e("div",null,[a[9]||(a[9]=P("çŠ¶æ€: ",-1)),e("span",{class:he(D.value)},I(d.value),3)]),e("div",null,"æ—¶é—´: "+I(S.value),1),l.value?(w(),U("div",mt,[e("div",null,"MAC: "+I(l.value.MAC),1),e("div",null,"HubToken: "+I(l.value.HubToken),1),e("div",null,"HubSn: "+I(l.value.HubSn),1)])):(w(),U("div",bt,"å°šæœªè¯»å–åˆ°é…ç½‘æ•°æ®"))]),e("button",{onClick:s,class:"open-btn",disabled:!k(n)}," å¼€å§‹ç”Ÿæˆæ•°æ®å‘é€ ",8,gt),A.value?(w(),U("div",yt,[e("div",Ct,[se(Le,{onGenerated:F}),L.value?(w(),U("div",wt,[a[10]||(a[10]=P(" å·²é€‰æ‹©: ",-1)),e("code",null,I(L.value),1)])):q("",!0),e("button",{onClick:a[4]||(a[4]=c=>ae(b.value)),disabled:!k(n)}," å‘é€ç”Ÿæˆæ•°æ® ",8,At)])])):q("",!0),e("button",{onClick:$,disabled:!k(n),class:"open-btn"},"æ‰“å¼€WIFIé…ç½‘é¡µé¢",8,St),se(tt,{visible:T.value,"onUpdate:visible":a[5]||(a[5]=c=>T.value=c),onConfirmed:X,onClosed:M},null,8,["visible"]),e("div",Ut,[e("label",null,[x(e("input",{type:"radio",value:"string","onUpdate:modelValue":a[6]||(a[6]=c=>o.value=c)},null,512),[[Z,o.value]]),a[11]||(a[11]=P(" å­—ç¬¦ä¸²æ˜¾ç¤º",-1))]),e("label",null,[x(e("input",{type:"radio",value:"hex","onUpdate:modelValue":a[7]||(a[7]=c=>o.value=c)},null,512),[[Z,o.value]]),a[12]||(a[12]=P(" Hex æ˜¾ç¤º",-1))]),e("label",null,[x(e("input",{type:"radio",value:"decrypt","onUpdate:modelValue":a[8]||(a[8]=c=>o.value=c)},null,512),[[Z,o.value]]),a[13]||(a[13]=P(" è§£å¯†æ˜¾ç¤º",-1))])]),e("h3",null,[a[14]||(a[14]=P("æŽ¥æ”¶æ•°æ® ",-1)),e("button",{onClick:ie},"æ¸…é™¤")]),(w(!0),U(G,null,J(h.value,(c,B)=>(w(),U("div",{key:B},[e("pre",null,I(c.time)+" | "+I(c.uuid)+" | "+I(c.data),1)]))),128)),e("div",ht,[e("h3",null,[a[15]||(a[15]=P("æ—¥å¿— ",-1)),e("button",{onClick:z},"æ¸…é™¤")]),(w(!0),U(G,null,J(g.value,(c,B)=>(w(),U("div",{key:B},I(c),1))),128))])]))}}),It=oe(Dt,[["__scopeId","data-v-42a3f024"]]);export{It as default};
