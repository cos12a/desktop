import{d as Y,s as q,r as n,c as u,a as t,u as s,t as f,w as v,b as a,v as C,e as z,f as G,g as D,F as H,h as M,o as i,_ as J}from"./index-B27VgFVv.js";import{u as O}from"./bluetoothConnection-BJyjnzJ4.js";import{u as P,e as Q,d as X}from"./crypto-C2FAsCm-.js";const Z={class:"page"},h={class:"controls"},_=["disabled"],ee=["disabled"],le={key:0},te={key:1},ne={class:"controls"},se=["disabled"],oe=["disabled"],ue={key:0},ae={key:1},ie={class:"checkbox-group"},de={class:"controls"},re=["disabled"],ve={class:"checkbox-group"},pe={class:"log"},be="0000ffe1-0000-1000-8000-00805f9b34fb",T="YellowSubmarine_",fe=Y({__name:"Home",setup(ce){const c=O(),{isConnected:d,device:F,server:B,isSupported:I}=q(c);n("0000ffe1-0000-1000-8000-00805f9b34fb");const m=n("0000ffe2-0000-1000-8000-00805f9b34fb"),x=n(""),S=n(!1),U=n(!1),V=n(!1),$=n(!1),b=n([]),y=n(!1),w=P(B,be),k=n([]);async function L(o){if(!d.value)return;await w.subscribe(o,l=>R(o,l))?(console.log(`✅ 成功订阅 ${o}`),y.value=!0):console.warn(`❌ 订阅失败 ${o}`)}function N(o){d.value&&(w.unsubscribe(o),y.value=!1)}n(null);const r=n("string");async function E(o){if(!B.value){b.value.push("❌ 未连接，无法发送");return}let e=x.value;if(S.value&&(e+="\r"),U.value&&(e+=`
`),V.value){const l=Q(e,T);if(!l){b.value.push("❌ 加密失败");return}e=l}console.log("➡️ 发送数据:",e);try{await w.send(o,e),b.value.push(`➡️ 已发送: ${e}`)}catch(l){b.value.push("❌ 发送失败: "+(l?.message||l))}}function R(o,e){const l=Array.from(e).map(W=>W.toString(16).padStart(2,"0")).join("");let p="";try{p=new TextDecoder().decode(e)}catch{p="[解码失败]"}let g="";r.value==="hex"?g=l:r.value==="decrypt"?g=X(l,T):g=p;const A=new Date().toLocaleTimeString();k.value.unshift({time:A,uuid:o,data:g}),k.value.length>20&&k.value.splice(20)}function K(){b.value=[]}function j(){k.value=[]}return(o,e)=>(i(),u("section",Z,[e[23]||(e[23]=t("h1",null,"Web 蓝牙 Demo",-1)),t("div",h,[t("button",{onClick:e[0]||(e[0]=(...l)=>s(c).connect&&s(c).connect(...l)),disabled:!s(I)||s(d)},"连接",8,_),t("button",{onClick:e[1]||(e[1]=(...l)=>s(c).disconnect&&s(c).disconnect(...l)),disabled:!s(d)},"断开",8,ee),s(d)?(i(),u("span",le,"✅ 已连接: "+f(s(F)?.name||"未知设备"),1)):(i(),u("span",te,"❌ 未连接"))]),e[24]||(e[24]=t("h3",null,"蓝牙特征订阅控制",-1)),t("div",ne,[t("strong",null,f(m.value),1),t("button",{onClick:e[2]||(e[2]=l=>L(m.value)),disabled:!s(d)||y.value},"订阅Shell",8,se),t("button",{onClick:e[3]||(e[3]=l=>N(m.value)),disabled:!s(d)||!y.value},"取消订阅Shell",8,oe),y.value?(i(),u("span",ue,"📡 已订阅")):(i(),u("span",ae,"未订阅"))]),t("div",ie,[t("label",null,[v(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>S.value=l)},null,512),[[C,S.value]]),e[14]||(e[14]=a(" 数据增加 \\r",-1))]),t("label",null,[v(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>U.value=l)},null,512),[[C,U.value]]),e[15]||(e[15]=a(" 数据增加 \\n",-1))]),t("label",null,[v(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=l=>V.value=l)},null,512),[[C,V.value]]),e[16]||(e[16]=a(" 加密发送",-1))]),t("label",null,[v(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>$.value=l)},null,512),[[C,$.value]]),e[17]||(e[17]=a(" Hex 格式发送",-1))])]),t("div",de,[v(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>x.value=l),placeholder:"输入要发送的数据",onKeyup:e[9]||(e[9]=G(l=>E(m.value),["enter"]))},null,544),[[z,x.value]]),t("button",{onClick:e[10]||(e[10]=l=>E(m.value)),disabled:!s(d)||!x.value},"发送",8,re)]),t("div",ve,[t("label",null,[v(t("input",{type:"radio",value:"string","onUpdate:modelValue":e[11]||(e[11]=l=>r.value=l)},null,512),[[D,r.value]]),e[18]||(e[18]=a(" 字符串显示",-1))]),t("label",null,[v(t("input",{type:"radio",value:"hex","onUpdate:modelValue":e[12]||(e[12]=l=>r.value=l)},null,512),[[D,r.value]]),e[19]||(e[19]=a(" Hex 显示",-1))]),t("label",null,[v(t("input",{type:"radio",value:"decrypt","onUpdate:modelValue":e[13]||(e[13]=l=>r.value=l)},null,512),[[D,r.value]]),e[20]||(e[20]=a(" 解密显示",-1))])]),t("h3",null,[e[21]||(e[21]=a("接收数据 ",-1)),t("button",{onClick:j},"清除")]),(i(!0),u(H,null,M(k.value,(l,p)=>(i(),u("div",{key:p},[t("pre",null,f(l.time)+" | "+f(l.uuid)+" | "+f(l.data),1)]))),128)),t("div",pe,[t("h3",null,[e[22]||(e[22]=a("日志 ",-1)),t("button",{onClick:K},"清除")]),(i(!0),u(H,null,M(b.value,(l,p)=>(i(),u("div",{key:p},f(l),1))),128))])]))}}),xe=J(fe,[["__scopeId","data-v-8b87c302"]]);export{xe as default};
