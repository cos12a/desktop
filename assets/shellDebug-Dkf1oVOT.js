import{d as R,r as p,n as V,c as b,a as n,u,t as x,b as A,w as $,f as M,g as m,p as S,o as _,_ as q}from"./index-D3lqa7Eb.js";import{u as H}from"./index-D0FcuMVo.js";const J={class:"page"},W={class:"controls"},z=["disabled"],F=["disabled"],G={key:0},Q={key:1},X={class:"controls"},Y=["disabled"],Z=["disabled"],ee=["disabled"],te={key:0},ne={key:1},oe={class:"log"},ae={class:"controls"},se=["onKeydown","disabled"],le=["disabled"],D="0000ffe1-0000-1000-8000-00805f9b34fb",w="0000ffe2-0000-1000-8000-00805f9b34fb",ce=R({__name:"shellDebug",setup(ie){const{isSupported:L,isConnected:d,device:y,requestDevice:N,server:v}=H({acceptAllDevices:!0,filters:[{namePrefix:"UNITO"}],optionalServices:["0000ffe0-0000-1000-8000-00805f9b34fb","0000ffe1-0000-1000-8000-00805f9b34fb"]}),a=p(""),f=p([]),s=p(!1),U=p();let l=null,c=null;async function E(){try{await N(),console.log("æ‰‹åŠ¨è¿æ¥è“ç‰™è®¾å¤‡ï¼Œè¿æ¥æˆåŠŸï¼")}catch(t){console.error("è“ç‰™è¿å¤±è´¥:",t)}}V(d,t=>{t?(console.log("ç›‘å¬è“ç‰™è®¾å¤‡è¿æ¥è¿æ¥æˆåŠŸï¼"),C()):(console.log("ç›‘å¬è“ç‰™è®¾å¤‡è¿æ¥æ–­å¼€"),g())});function B(){y.value?.gatt?.connected&&(y.value.gatt.disconnect(),s.value=!1,g())}async function T(){if(!v.value){alert("âŒ è®¾å¤‡æœªè¿æ¥");return}try{const t=await v.value.getPrimaryServices();for(const e of t){console.log("ğŸ”¹ Service:",e.uuid);const o=await e.getCharacteristics();for(const h of o)console.log("   â†³ Characteristic:",h.uuid,"Properties:",JSON.stringify(h.properties))}}catch(t){console.error("æ‰«ææœåŠ¡/ç‰¹å¾å¤±è´¥:",t),alert("âŒ æ‰«ææœåŠ¡/ç‰¹å¾å¤±è´¥")}}async function C(){if(v.value)try{const e=await(await v.value.getPrimaryService(D)).getCharacteristic(w);l&&c&&(c.removeEventListener("characteristicvaluechanged",l),l=null),e.properties.notify?(await e.startNotifications(),l=o=>{const h=new Uint8Array(o.target.value.buffer);O(h)},e.addEventListener("characteristicvaluechanged",l),c=e,s.value=!0):alert("âŒ å½“å‰ç‰¹å¾ä¸æ”¯æŒé€šçŸ¥")}catch(t){console.error("è·å–ç‰¹å¾å¤±è´¥:",t),alert(`âŒ æ— æ³•æ‰¾åˆ°ç‰¹å¾ ${w}ï¼Œè¯·æ£€æŸ¥è®¾å¤‡æ”¯æŒçš„æœåŠ¡/ç‰¹å¾`)}}async function g(){try{l&&c&&(c.removeEventListener("characteristicvaluechanged",l),l=null),c&&(await c.stopNotifications().catch(()=>{console.warn("é€šçŸ¥å·²åœæ­¢æˆ–è®¾å¤‡å·²æ–­å¼€")}),c=null)}catch(t){console.error("å…³é—­ Shell å‡ºé”™:",t)}s.value=!1}async function k(){if(!v.value||!a.value)return;const e=await(await v.value.getPrimaryService(D)).getCharacteristic(w),o=a.value+`\r
`,h=new TextEncoder().encode(o);await e.writeValue(h),i.value.push(a.value),r.value=i.value.length,a.value=""}function O(t){let e="";try{e=new TextDecoder().decode(t)}catch{e="[è§£ç å¤±è´¥]"}const o=new Date().toLocaleTimeString();f.value.unshift(`${o} | ${e.trimEnd()}`),f.value.length>200&&f.value.pop()}function P(){f.value=[]}function j(){const t=new Blob([f.value.join(`
`)],{type:"text/plain;charset=utf-8"}),e=URL.createObjectURL(t),o=document.createElement("a");o.href=e,o.download="ble-shell-log.txt",o.click(),URL.revokeObjectURL(e)}const i=p([]),r=p(-1);function I(){i.value.length!==0&&r.value>0&&(r.value--,a.value=i.value[r.value])}function K(){i.value.length!==0&&(r.value<i.value.length-1?(r.value++,a.value=i.value[r.value]):(r.value=i.value.length,a.value=""))}return(t,e)=>(_(),b("section",J,[e[2]||(e[2]=n("h1",null,"Web è“ç‰™ Shell è°ƒè¯•",-1)),n("div",W,[n("button",{onClick:E,disabled:!u(L)||u(d)},"è¿æ¥",8,z),n("button",{onClick:B,disabled:!u(d)},"æ–­å¼€",8,F),u(d)?(_(),b("span",G,"âœ… å·²è¿æ¥: "+x(u(y)?.name||"æœªçŸ¥è®¾å¤‡"),1)):(_(),b("span",Q,"âŒ æœªè¿æ¥"))]),n("div",X,[n("button",{onClick:C,disabled:!u(d)||s.value},"æ‰“å¼€ Shell è°ƒè¯•",8,Y),n("button",{onClick:g,disabled:!s.value},"å…³é—­ Shell è°ƒè¯•",8,Z),n("button",{onClick:T,disabled:!u(d)}," æ‰«ææœåŠ¡/ç‰¹å¾ ",8,ee),s.value?(_(),b("span",te,"ğŸ“¡ Shell è°ƒè¯•å·²æ‰“å¼€")):(_(),b("span",ne,"æœªæ‰“å¼€"))]),n("div",oe,[n("h3",null,[e[1]||(e[1]=A(" æ¥æ”¶æ•°æ® ",-1)),n("button",{onClick:P},"æ¸…é™¤"),n("button",{onClick:j},"ä¿å­˜")]),n("pre",{ref_key:"recvBox",ref:U,class:"recv-box"},""+x(f.value.join(`
`))+`
      `,513)]),n("div",ae,[$(n("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>a.value=o),placeholder:"è¾“å…¥å‘½ä»¤åå›è½¦å‘é€",onKeyup:m(k,["enter"]),onKeydown:[m(S(I,["prevent"]),["up"]),m(S(K,["prevent"]),["down"])],disabled:!s.value},null,40,se),[[M,a.value]]),n("button",{onClick:k,disabled:!s.value||!a.value},"å‘é€",8,le)])]))}}),de=q(ce,[["__scopeId","data-v-4366f9db"]]);export{de as default};
