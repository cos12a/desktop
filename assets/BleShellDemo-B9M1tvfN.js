import{u}from"./index-CNDZsMhZ.js";import{e as p,d as w}from"./crypto-wJwxBhvd.js";import{d as m,c,a as o,j as y,u as n,t as v,k as _,o as h,_ as b}from"./index-CogBM-TU.js";class E{constructor(e,i,t){this.server=null,this.logs=[],this.notifyEntries=[],this.password="YellowSubmarine_",this.characteristic=null,this.notifyCb=null,this.server=e,this.serviceUuid=i,this.charUuid=t}async init(){if(!this.server)throw new Error("未连接 GATT Server");const e=await this.server.getPrimaryService(this.serviceUuid);this.characteristic=await e.getCharacteristic(this.charUuid),this.characteristic.properties.notify&&(await this.characteristic.startNotifications(),this.characteristic.addEventListener("characteristicvaluechanged",i=>{const t=new Uint8Array(i.target.value.buffer);this.handleNotify(t)})),this.logs.push("✅ 特征初始化完成")}handleNotify(e){const i=Array.from(e).map(a=>a.toString(16).padStart(2,"0")).join("");let t="";try{t=new TextDecoder().decode(e)}catch{t="[解码失败]"}const r=new Date().toLocaleTimeString();this.notifyEntries.unshift({time:r,hex:i,text:t}),this.notifyEntries.length>16&&this.notifyEntries.splice(0,this.notifyEntries.length-16)}async sendText(e,i=!1){if(!this.characteristic)throw new Error("特征未初始化");let t;if(i){const r=p(e,this.password);if(!r)throw new Error("加密失败");const a=r.match(/.{1,2}/g)?.map(s=>parseInt(s,16))||[];t=new Uint8Array(a)}else t=new TextEncoder().encode(e);await this.characteristic.writeValue(t),this.logs.push(`➡️ 已发送: ${i?"(加密HEX)":"(UTF-8)"} ${e}`)}decryptHex(e){return w(e,this.password)}}const g=["disabled"],x={key:0},S=["disabled"],B=m({__name:"BleShellDemo",setup(l){const{isSupported:e,isConnected:i,device:t,requestDevice:r,server:a}=u({acceptAllDevices:!0,optionalServices:["0000ffe0-0000-1000-8000-00805f9b34fb"]});let s=null;async function d(){await r(),a.value&&(s=_(new E(a.value,"0000ffe0-0000-1000-8000-00805f9b34fb","0000ffe1-0000-1000-8000-00805f9b34fb")),await s.init())}async function f(){s&&await s.sendText("Hello BLE",!0)}return(C,T)=>(h(),c("section",null,[o("button",{onClick:d,disabled:!n(e)},"连接蓝牙",8,g),n(i)?(h(),c("div",x,"已连接: "+v(n(t)?.name),1)):y("",!0),o("button",{onClick:f,disabled:!n(s)},"发送加密数据",8,S)]))}}),A=b(B,[["__scopeId","data-v-e19a44a3"]]);export{A as default};
