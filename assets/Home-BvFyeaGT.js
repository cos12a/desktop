import{d as O,r as u,c as d,a as t,u as p,t as k,b as i,w as r,v as N,e as h,f as W,g as Y,h as S,F as B,i as H,o as v,_ as z}from"./index-D3lqa7Eb.js";import{u as G}from"./index-D0FcuMVo.js";import{e as J,d as Q}from"./crypto-wJwxBhvd.js";const X={class:"page"},Z={class:"controls"},ee=["disabled"],te=["disabled"],le={key:0},ae={key:1},se={class:"controls"},ne={class:"controls"},oe=["disabled"],ue=["disabled"],ie={key:0},re={key:1},de={class:"checkbox-group"},ve={class:"controls"},fe=["disabled"],pe={class:"checkbox-group"},ce={class:"log"},be={class:"log"},I="YellowSubmarine_",ye=O({__name:"Home",setup(me){const{isSupported:T,isConnected:y,device:C,requestDevice:L,server:c}=G({acceptAllDevices:!0,filters:[{namePrefix:"UNITO"}],optionalServices:["0000ffe0-0000-1000-8000-00805f9b34fb","0000ffe1-0000-1000-8000-00805f9b34fb"]}),m=u("0000ffe1-0000-1000-8000-00805f9b34fb"),a=u("0000ffe2-0000-1000-8000-00805f9b34fb"),w=u(""),F=u(!1),V=u(!1),U=u(!1),E=u(!1),n=u([]),g=u([]),f=u("string");async function M(){await L(),n.value.push("🔗 请求连接蓝牙设备")}function A(){C.value?.gatt?.connected&&(C.value.gatt.disconnect(),n.value.push("❌ 已断开连接"))}async function D(){if(!c.value){n.value.push("❌ 未连接，无法发送");return}let o=w.value;if(F.value&&(o+="\r"),V.value&&(o+=`
`),U.value){const l=J(o,I);if(!l){n.value.push("❌ 加密失败");return}o=l}let e;if(E.value||U.value){const l=o.match(/.{1,2}/g)?.map(s=>parseInt(s,16))||[];e=new Uint8Array(l)}else e=new TextEncoder().encode(o);try{await(await(await c.value.getPrimaryService(m.value)).getCharacteristic(a.value)).writeValue(e),n.value.push(`➡️ 已发送: ${o}`)}catch(l){n.value.push("❌ 发送失败: "+(l?.message||l))}}const x=u({});async function P(){if(!c.value)return;const e=await(await c.value.getPrimaryService(m.value)).getCharacteristic(a.value);if(e.properties.notify){await e.startNotifications();const l=s=>{const b=new Uint8Array(s.target.value.buffer);K(a.value,b)};e.addEventListener("characteristicvaluechanged",l),x.value[a.value]=!0,n.value.push(`📡 已订阅 ${a.value}`)}}async function $(){if(!c.value)return;const e=await(await c.value.getPrimaryService(m.value)).getCharacteristic(a.value);try{await e.stopNotifications(),x.value[a.value]=!1,n.value.push(`❌ 已取消订阅 ${a.value}`)}catch(l){n.value.push("❌ 取消订阅失败: "+(l?.message||l))}}function K(o,e){const l=Array.from(e).map(q=>q.toString(16).padStart(2,"0")).join("");let s="";try{s=new TextDecoder().decode(e)}catch{s="[解码失败]"}let b="";f.value==="hex"?b=l:f.value==="decrypt"?b=Q(l,I):b=s;const j=new Date().toLocaleTimeString();g.value.unshift({time:j,data:`${b}`}),g.value.length>20&&g.value.splice(20)}function R(){n.value=[]}function _(){g.value=[]}return(o,e)=>(v(),d("section",X,[e[23]||(e[23]=t("h1",null,"Web 蓝牙 Demo",-1)),t("div",Z,[t("button",{onClick:M,disabled:!p(T)||p(y)},"连接",8,ee),t("button",{onClick:A,disabled:!p(y)},"断开",8,te),p(y)?(v(),d("span",le,"✅ 已连接: "+k(p(C)?.name||"未知设备"),1)):(v(),d("span",ae,"❌ 未连接"))]),t("div",se,[t("label",null,[e[11]||(e[11]=i(" 服务 UUID: ",-1)),r(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>m.value=l)},[...e[10]||(e[10]=[t("option",{value:"0000ffe0-0000-1000-8000-00805f9b34fb"},"FFE0",-1),t("option",{value:"0000ffe1-0000-1000-8000-00805f9b34fb"},"FFE1",-1)])],512),[[N,m.value]])]),t("label",null,[e[13]||(e[13]=i(" 特征 UUID: ",-1)),r(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>a.value=l)},[...e[12]||(e[12]=[t("option",{value:"0000ffe0-0000-1000-8000-00805f9b34fb"},"FFE0",-1),t("option",{value:"0000ffe1-0000-1000-8000-00805f9b34fb"},"FFE1",-1),t("option",{value:"0000ffe2-0000-1000-8000-00805f9b34fb"},"FFE2",-1),t("option",{value:"0000ffe3-0000-1000-8000-00805f9b34fb"},"FFE3",-1)])],512),[[N,a.value]])])]),t("div",ne,[t("button",{onClick:P,disabled:!p(y)||x.value[a.value]},"订阅通知",8,oe),t("button",{onClick:$,disabled:!x.value[a.value]},"取消订阅",8,ue),x.value[a.value]?(v(),d("span",ie,"📡 已订阅 "+k(a.value),1)):(v(),d("span",re,"未订阅"))]),t("div",de,[t("label",null,[r(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=l=>F.value=l)},null,512),[[h,F.value]]),e[14]||(e[14]=i(" 数据增加 \\r",-1))]),t("label",null,[r(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=l=>V.value=l)},null,512),[[h,V.value]]),e[15]||(e[15]=i(" 数据增加 \\n",-1))]),t("label",null,[r(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>U.value=l)},null,512),[[h,U.value]]),e[16]||(e[16]=i(" 加密发送",-1))]),t("label",null,[r(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>E.value=l)},null,512),[[h,E.value]]),e[17]||(e[17]=i(" Hex 格式发送",-1))])]),t("div",ve,[r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>w.value=l),placeholder:"输入要发送的数据",onKeyup:Y(D,["enter"])},null,544),[[W,w.value]]),t("button",{onClick:D,disabled:!p(y)||!w.value},"发送",8,fe)]),t("div",pe,[t("label",null,[r(t("input",{type:"radio",value:"string","onUpdate:modelValue":e[7]||(e[7]=l=>f.value=l)},null,512),[[S,f.value]]),e[18]||(e[18]=i(" 字符串显示",-1))]),t("label",null,[r(t("input",{type:"radio",value:"hex","onUpdate:modelValue":e[8]||(e[8]=l=>f.value=l)},null,512),[[S,f.value]]),e[19]||(e[19]=i(" Hex 显示",-1))]),t("label",null,[r(t("input",{type:"radio",value:"decrypt","onUpdate:modelValue":e[9]||(e[9]=l=>f.value=l)},null,512),[[S,f.value]]),e[20]||(e[20]=i(" 解密显示",-1))])]),t("div",ce,[t("h3",null,[e[21]||(e[21]=i("接收数据 ",-1)),t("button",{onClick:_},"清除")]),(v(!0),d(B,null,H(g.value,(l,s)=>(v(),d("div",{key:s},[t("pre",null,k(l.time)+" | "+k(l.data),1)]))),128))]),t("div",be,[t("h3",null,[e[22]||(e[22]=i("日志 ",-1)),t("button",{onClick:R},"清除")]),(v(!0),d(B,null,H(n.value,(l,s)=>(v(),d("div",{key:s},k(l),1))),128))])]))}}),we=z(ye,[["__scopeId","data-v-aa02f2bf"]]);export{we as default};
