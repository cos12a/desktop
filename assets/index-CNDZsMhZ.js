import{z as A,A as y,B as m,C as D,D as E,n as S,E as s,G as O,q as b,H as d,u as j}from"./index-CogBM-TU.js";function C(e){return D()?(E(e),!0):!1}const M=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const w=Object.prototype.toString,B=e=>w.call(e)==="[object Object]";function g(e){return Array.isArray(e)?e:[e]}function G(e){return m()}function L(e,n=!0,o){G()?y(e,o):n?e():A(e)}function W(e,n,o){return S(e,n,{...o,immediate:!0})}const k=M?window:void 0,q=M?window.navigator:void 0;function x(e){var n;const o=d(e);return(n=o?.$el)!=null?n:o}function I(...e){const n=[],o=()=>{n.forEach(t=>t()),n.length=0},v=(t,u,l,i)=>(t.addEventListener(u,l,i),()=>t.removeEventListener(u,l,i)),r=b(()=>{const t=g(d(e[0])).filter(u=>u!=null);return t.every(u=>typeof u!="string")?t:void 0}),f=W(()=>{var t,u;return[(u=(t=r.value)==null?void 0:t.map(l=>x(l)))!=null?u:[k].filter(l=>l!=null),g(d(r.value?e[1]:e[0])),g(j(r.value?e[2]:e[1])),d(r.value?e[3]:e[2])]},([t,u,l,i])=>{if(o(),!t?.length||!u?.length||!l?.length)return;const p=B(i)?{...i}:i;n.push(...t.flatMap(h=>u.flatMap(c=>l.map(T=>v(h,c,T,p)))))},{flush:"post"}),a=()=>{f(),o()};return C(o),a}function z(){const e=s(!1),n=m();return n&&y(()=>{e.value=!0},n),e}function H(e){const n=z();return b(()=>(n.value,!!e()))}function P(e){let{acceptAllDevices:n=!1}=e||{};const{filters:o=void 0,optionalServices:v=void 0,navigator:r=q}=e||{},f=H(()=>r&&"bluetooth"in r),a=s(),t=s(null);S(a,()=>{h()});async function u(){if(f.value){t.value=null,o&&o.length>0&&(n=!1);try{a.value=await r?.bluetooth.requestDevice({acceptAllDevices:n,filters:o,optionalServices:v})}catch(c){t.value=c}}}const l=s(),i=s(!1);function p(){i.value=!1,a.value=void 0,l.value=void 0}async function h(){if(t.value=null,a.value&&a.value.gatt){I(a,"gattserverdisconnected",p,{passive:!0});try{l.value=await a.value.gatt.connect(),i.value=l.value.connected}catch(c){t.value=c}}}return L(()=>{var c;a.value&&((c=a.value.gatt)==null||c.connect())}),C(()=>{var c;a.value&&((c=a.value.gatt)==null||c.disconnect())}),{isSupported:f,isConnected:O(i),device:a,requestDevice:u,server:l,error:t}}export{P as u};
